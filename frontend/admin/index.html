<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="../style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css"
    />
    <!-- jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- DataTables library -->
    <link
      href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css"
    />
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"
    ></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="../js/api.js"></script>

    <title>Página do Administrador</title>
  </head>

  <body>
    <h1>Painel de Administração</h1>

    <main>
      <div class="tabelaUsuario">
        <table id="tabelaUsuario">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Crédito</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="tabelaRodada">
        <table id="tabelaRodada">
          <thead>
            <tr>
              <th>Jogo1</th>
              <th>Jogo2</th>
              <th>Jogo3</th>
              <th>Jogo4</th>
              <th>Jogo5</th>
              <th>Jogo6</th>
              <th>Jogo7</th>
              <th>Jogo8</th>
              <th>Jogo9</th>
              <th>Jogo10</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </main>

    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"
    ></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"
      crossorigin="anonymous"
    ></script>

    <script>
      const tabelaUsuario = document.getElementById("tabelaUsuario");
      const tbodyTabelaUsuario = tabelaUsuario.querySelector("tbody");
      const tabelaRodada = document.getElementById("tabelaRodada");
      const tbodyTabelaRodada = tabelaRodada.querySelector("tbody");

      const getRodadas = async () => {
        const response = await api.get("/rodada/listar");
        return response.data.rodadas;
      };

      const getUsuarios = async () => {
        const response = await api.get("/usuario/listar");
        return response.data.usuarios;
      };

      const showRodadas = async () => {
        const rodadas = await getRodadas();
        rodadas.forEach((rodada) => {
          console.log(rodada);
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${rodada.jogo1}</td>
            <td>${rodada.jogo2}</td>
            <td>${rodada.jogo3}</td>
            <td>${rodada.jogo4}</td>
            <td>${rodada.jogo5}</td>
            <td>${rodada.jogo6}</td>
            <td>${rodada.jogo7}</td>
            <td>${rodada.jogo8}</td>
            <td>${rodada.jogo9}</td>
            <td>${rodada.jogo10}</td>
          `;
          tbodyTabelaRodada.appendChild(tr);
        });
        $(document).ready(() => {
          $("#tabelaRodada").DataTable();
        });
      };
      showRodadas();

      const showUsuarios = async () => {
        const usuarios = await getUsuarios();
        usuarios.forEach((usuario) => {
          console.log(usuario);
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${usuario.nomeCompleto}</td>
            <td>${usuario.creditos}</td>
            <td>
              <button onclick="editarCredito('${usuario.id}')">Editar Crédito</button>
              <button onclick="excluirUsuario('${usuario.id}')">Excluir Usuário</button>
            </td>
          `;
          tbodyTabelaUsuario.appendChild(tr);
        });
        $(document).ready(() => {
          $("#tabelaUsuario").DataTable();
        });
      };
      showUsuarios();

      const editarCredito = (userId) => {
        const creditos = prompt("Digite o novo valor de crédito:");
        if (creditos !== null) {
          // Enviar a requisição para atualizar o crédito do usuário
          api
            .put("/usuario/creditos/" + userId, { creditos })
            .then((response) => {
              console.log("Crédito atualizado com sucesso!");
              window.location.reload();
            })
            .catch((error) => {
              console.error("Erro ao atualizar o crédito:", error);
            });
        }
      };

      const excluirUsuario = (userId) => {
        if (confirm("Tem certeza que deseja excluir esse usuário?")) {
          // Enviar a requisição para excluir o usuário
          api
            .delete("/usuario/deletar/" + userId)
            .then((response) => {
              console.log("Usuário excluído com sucesso!");
              window.location.reload();
            })
            .catch((error) => {
              console.error("Erro ao excluir o usuário:", error);
            });
        }
      };
    </script>
  </body>
</html>
